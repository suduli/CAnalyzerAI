<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Display Validation Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .test-section {
            background: #2a2a2a;
            border-radius: 8px;
            margin: 20px 0;
            padding: 20px;
            border-left: 4px solid #39ff14;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .pass {
            background: rgba(57, 255, 20, 0.1);
            border: 1px solid #39ff14;
            color: #39ff14;
        }
        .fail {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid #ff4757;
            color: #ff4757;
        }
        .warning {
            background: rgba(255, 171, 0, 0.1);
            border: 1px solid #ffab00;
            color: #ffab00;
        }
        .metric-display {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .button {
            background: #39ff14;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .button:hover {
            background: #2dd10f;
        }
    </style>
</head>
<body>
    <h1>üîç Data Display Validation Test</h1>
    <p>Testing enhanced data display functions against Unity C reference data</p>

    <div class="test-section">
        <h2>üìä Reference Data (Unity C Analysis)</h2>
        <div class="metric-display">
            <span>Lines of Code:</span>
            <span id="refLOC">1876</span>
        </div>
        <div class="metric-display">
            <span>Complexity Level 1:</span>
            <span id="refC1">278</span>
        </div>
        <div class="metric-display">
            <span>Complexity Level 2:</span>
            <span id="refC2">195</span>
        </div>
        <div class="metric-display">
            <span>Complexity Level 3:</span>
            <span id="refC3">432</span>
        </div>
    </div>

    <div class="test-section">
        <h2>üß™ Formatting Function Tests</h2>
        <div id="formattingTests"></div>
        <button class="button" onclick="runFormattingTests()">Run Formatting Tests</button>
    </div>

    <div class="test-section">
        <h2>üîÑ Data Validation Tests</h2>
        <div id="validationTests"></div>
        <button class="button" onclick="runValidationTests()">Run Validation Tests</button>
    </div>

    <div class="test-section">
        <h2>üìà Comparison Function Tests</h2>
        <div id="comparisonTests"></div>
        <button class="button" onclick="runComparisonTests()">Run Comparison Tests</button>
    </div>

    <div class="test-section">
        <h2>üìã Export Function Tests</h2>
        <div id="exportTests"></div>
        <button class="button" onclick="runExportTests()">Run Export Tests</button>
    </div>

    <div class="test-section">
        <h2>üéØ Full Integration Test</h2>
        <div id="integrationResults"></div>
        <button class="button" onclick="runFullIntegrationTest()">Run Full Integration Test</button>
    </div>

    <script>
        // Copy enhanced functions from app.js for testing
        function formatForDisplayWithValidation(value, context = '', includeValidation = true) {
            if (value === null || value === undefined) {
                console.warn(`[Data Validation] Null/undefined value in context: ${context}`);
                return includeValidation ? { display: 'N/A', valid: false, warnings: ['Null/undefined value'] } : 'N/A';
            }
            
            if (typeof value === 'string') {
                const parsed = parseFloat(value);
                if (isNaN(parsed)) {
                    console.warn(`[Data Validation] Invalid numeric string in context: ${context}, value: ${value}`);
                    return includeValidation ? { display: value, valid: false, warnings: ['Invalid numeric format'] } : value;
                }
                value = parsed;
            }
            
            if (typeof value !== 'number') {
                console.warn(`[Data Validation] Non-numeric value in context: ${context}, type: ${typeof value}`);
                return includeValidation ? { display: String(value), valid: false, warnings: ['Non-numeric value'] } : String(value);
            }
            
            const warnings = [];
            let display;
            
            // Enhanced precision handling
            if (Number.isInteger(value)) {
                display = value.toString();
            } else {
                // Use precise decimal handling for floating point
                const precision = Math.max(0, Math.min(6, String(value).split('.')[1]?.length || 0));
                display = value.toFixed(precision).replace(/\.?0+$/, '');
            }
            
            // Validation checks
            if (value < 0) {
                warnings.push('Negative value detected');
            }
            if (value > 1000000) {
                warnings.push('Extremely large value');
            }
            if (!Number.isFinite(value)) {
                warnings.push('Non-finite number');
                display = 'Invalid';
            }
            
            if (includeValidation) {
                return {
                    display,
                    valid: warnings.length === 0,
                    warnings,
                    originalValue: value,
                    context
                };
            }
            
            return display;
        }

        function logDataValidation(data, source = 'Unknown') {
            if (!data || typeof data !== 'object') {
                console.warn(`[${source}] Invalid data object:`, data);
                return false;
            }
            
            const metrics = ['loc', 'complexity1', 'complexity2', 'complexity3'];
            let validCount = 0;
            
            console.group(`[${source}] Data Validation Report`);
            
            metrics.forEach(metric => {
                const value = data[metric];
                const validation = formatForDisplayWithValidation(value, `${source}.${metric}`);
                
                if (validation.valid) {
                    validCount++;
                    console.log(`‚úì ${metric}: ${validation.display} (Original: ${validation.originalValue})`);
                } else {
                    console.warn(`‚ö† ${metric}: ${validation.display} - Warnings: ${validation.warnings.join(', ')}`);
                }
            });
            
            const validationScore = (validCount / metrics.length) * 100;
            console.log(`Validation Score: ${validationScore}% (${validCount}/${metrics.length} valid)`);
            console.groupEnd();
            
            return validationScore === 100;
        }

        // Test data sets
        const testCases = [
            { value: 1876, expected: '1876', context: 'Integer LOC' },
            { value: 278.0, expected: '278', context: 'Float to Integer' },
            { value: 195.50, expected: '195.5', context: 'Decimal with trailing zero' },
            { value: 432.123456, expected: '432.123456', context: 'High precision decimal' },
            { value: 3.7, expected: '3.7', context: 'Simple decimal (precision test)' },
            { value: 0, expected: '0', context: 'Zero value' },
            { value: null, expected: 'N/A', context: 'Null value' },
            { value: undefined, expected: 'N/A', context: 'Undefined value' },
            { value: 'invalid', expected: 'invalid', context: 'Invalid string' },
            { value: '123.45', expected: '123.45', context: 'Valid string number' }
        ];

        function runFormattingTests() {
            const container = document.getElementById('formattingTests');
            container.innerHTML = '<h3>Running formatting tests...</h3>';
            
            let passed = 0;
            let total = testCases.length;
            let results = [];
            
            testCases.forEach((testCase, index) => {
                const result = formatForDisplayWithValidation(testCase.value, testCase.context);
                const displayValue = typeof result === 'object' ? result.display : result;
                const isPass = displayValue === testCase.expected;
                
                if (isPass) passed++;
                
                results.push(`
                    <div class="test-result ${isPass ? 'pass' : 'fail'}">
                        Test ${index + 1}: ${testCase.context}<br>
                        Input: ${JSON.stringify(testCase.value)}<br>
                        Expected: "${testCase.expected}"<br>
                        Got: "${displayValue}"<br>
                        Status: ${isPass ? 'PASS ‚úì' : 'FAIL ‚úó'}
                        ${typeof result === 'object' && result.warnings?.length ? `<br>Warnings: ${result.warnings.join(', ')}` : ''}
                    </div>
                `);
            });
            
            container.innerHTML = `
                <h3>Formatting Test Results: ${passed}/${total} passed</h3>
                ${results.join('')}
            `;
        }

        function runValidationTests() {
            const container = document.getElementById('validationTests');
            container.innerHTML = '<h3>Running validation tests...</h3>';
            
            const referenceData = {
                loc: 1876,
                complexity1: 278,
                complexity2: 195,
                complexity3: 432
            };
            
            const testData = [
                { data: referenceData, source: 'Reference Data', shouldPass: true },
                { data: { loc: 1876, complexity1: 278, complexity2: 195, complexity3: null }, source: 'Null Complexity', shouldPass: false },
                { data: { loc: '1876', complexity1: '278', complexity2: '195', complexity3: '432' }, source: 'String Numbers', shouldPass: true },
                { data: { loc: -1, complexity1: 278, complexity2: 195, complexity3: 432 }, source: 'Negative LOC', shouldPass: false },
                { data: null, source: 'Null Data', shouldPass: false }
            ];
            
            let results = [];
            
            testData.forEach((test, index) => {
                const isValid = logDataValidation(test.data, test.source);
                const expectedResult = test.shouldPass;
                const testPassed = isValid === expectedResult;
                
                results.push(`
                    <div class="test-result ${testPassed ? 'pass' : 'fail'}">
                        Validation Test ${index + 1}: ${test.source}<br>
                        Expected: ${expectedResult ? 'Valid' : 'Invalid'}<br>
                        Got: ${isValid ? 'Valid' : 'Invalid'}<br>
                        Status: ${testPassed ? 'PASS ‚úì' : 'FAIL ‚úó'}
                    </div>
                `);
            });
            
            container.innerHTML = `
                <h3>Validation Test Results</h3>
                ${results.join('')}
                <div class="test-result pass">
                    <strong>Check browser console for detailed validation logs</strong>
                </div>
            `;
        }

        function runComparisonTests() {
            const container = document.getElementById('comparisonTests');
            container.innerHTML = '<h3>Running comparison tests...</h3>';
            
            const staticData = { loc: 1876, complexity1: 278, complexity2: 195, complexity3: 432 };
            const aiData = { loc: 1880, complexity1: 275, complexity2: 198, complexity3: 430 };
            
            const differences = {
                loc: aiData.loc - staticData.loc,
                complexity1: aiData.complexity1 - staticData.complexity1,
                complexity2: aiData.complexity2 - staticData.complexity2,
                complexity3: aiData.complexity3 - staticData.complexity3
            };
            
            let results = [];
            
            Object.keys(differences).forEach(metric => {
                const diff = differences[metric];
                const formatted = formatForDisplayWithValidation(diff, `Comparison.${metric}`);
                const sign = diff > 0 ? '+' : '';
                
                results.push(`
                    <div class="test-result pass">
                        ${metric.toUpperCase()} Difference: ${sign}${formatted.display || formatted}<br>
                        Static: ${staticData[metric]}, AI: ${aiData[metric]}
                    </div>
                `);
            });
            
            container.innerHTML = `
                <h3>Comparison Test Results</h3>
                ${results.join('')}
            `;
        }

        function runExportTests() {
            const container = document.getElementById('exportTests');
            container.innerHTML = '<h3>Running export tests...</h3>';
            
            const testExportData = {
                timestamp: new Date().toISOString(),
                filename: 'test.c',
                static_analysis: {
                    loc: 1876,
                    complexity1: 278,
                    complexity2: 195,
                    complexity3: 432,
                    validation: {
                        score: 100,
                        warnings: []
                    }
                },
                ai_analysis: {
                    loc: 1880,
                    complexity1: 275,
                    complexity2: 198,
                    complexity3: 430,
                    validation: {
                        score: 100,
                        warnings: []
                    }
                },
                comparison: {
                    differences: {
                        loc: 4,
                        complexity1: -3,
                        complexity2: 3,
                        complexity3: -2
                    }
                },
                metadata: {
                    version: '1.0.0',
                    reference_source: 'unity.c analysis',
                    validation_timestamp: new Date().toISOString()
                }
            };
            
            try {
                const jsonString = JSON.stringify(testExportData, null, 2);
                const isValidJson = JSON.parse(jsonString);
                
                container.innerHTML = `
                    <div class="test-result pass">
                        Export JSON Validation: PASS ‚úì<br>
                        Size: ${jsonString.length} characters<br>
                        Includes metadata: ${testExportData.metadata ? 'Yes' : 'No'}<br>
                        Includes validation data: ${testExportData.static_analysis.validation ? 'Yes' : 'No'}
                    </div>
                    <div class="test-result pass">
                        <strong>Sample Export Structure:</strong><br>
                        <pre style="font-size: 0.8em; overflow-x: auto;">${jsonString.substring(0, 500)}...</pre>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="test-result fail">
                        Export JSON Validation: FAIL ‚úó<br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        function runFullIntegrationTest() {
            const container = document.getElementById('integrationResults');
            container.innerHTML = '<h3>Running full integration test...</h3>';
            
            // Simulate complete workflow
            const referenceData = { loc: 1876, complexity1: 278, complexity2: 195, complexity3: 432 };
            const testData = { loc: 1876.0, complexity1: 278, complexity2: 195.0, complexity3: 432 };
            
            // Test data validation
            const isReferenceValid = logDataValidation(referenceData, 'Reference');
            const isTestValid = logDataValidation(testData, 'Test');
            
            // Test formatting consistency
            let formattingConsistent = true;
            const formattingResults = {};
            
            Object.keys(referenceData).forEach(key => {
                const refFormatted = formatForDisplayWithValidation(referenceData[key], `ref.${key}`);
                const testFormatted = formatForDisplayWithValidation(testData[key], `test.${key}`);
                
                formattingResults[key] = {
                    reference: refFormatted.display || refFormatted,
                    test: testFormatted.display || testFormatted,
                    match: (refFormatted.display || refFormatted) === (testFormatted.display || testFormatted)
                };
                
                if (!formattingResults[key].match) {
                    formattingConsistent = false;
                }
            });
            
            // Calculate overall score
            const validationScore = (isReferenceValid && isTestValid) ? 100 : 50;
            const formattingScore = formattingConsistent ? 100 : 0;
            const overallScore = (validationScore + formattingScore) / 2;
            
            const resultsHtml = `
                <div class="test-result ${overallScore === 100 ? 'pass' : (overallScore > 50 ? 'warning' : 'fail')}">
                    <strong>Integration Test Results</strong><br>
                    Overall Score: ${overallScore}%<br>
                    Data Validation: ${validationScore}%<br>
                    Formatting Consistency: ${formattingScore}%
                </div>
                <div class="test-result pass">
                    <strong>Formatting Comparison:</strong><br>
                    ${Object.keys(formattingResults).map(key => 
                        `${key}: Ref="${formattingResults[key].reference}" vs Test="${formattingResults[key].test}" ${formattingResults[key].match ? '‚úì' : '‚úó'}`
                    ).join('<br>')}
                </div>
                <div class="test-result pass">
                    <strong>Data Integrity Verified:</strong><br>
                    ‚Ä¢ Enhanced formatting preserves precision<br>
                    ‚Ä¢ Validation pipeline catches edge cases<br>
                    ‚Ä¢ Export includes metadata and validation data<br>
                    ‚Ä¢ UI styling enhances data presentation clarity
                </div>
            `;
            
            container.innerHTML = resultsHtml;
        }

        // Auto-run basic test on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Data Display Validation Test Suite Loaded');
            console.log('Reference Unity C Analysis: LOC=1876, C1=278, C2=195, C3=432');
            runFormattingTests();
        });
    </script>
</body>
</html>
